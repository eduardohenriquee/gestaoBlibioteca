{% extends 'products/base.html' %} {% block content %}
<h1 class="my-4">
  <small>Livros</small>
</h1>

<!-- Botão para exportar CSV -->
{% if user.is_superuser or user.is_staff %}
<div class="row mb-4">
  <div class="col-12">
    <a href="{% url 'export_books_csv' %}?status=disponivel" class="me-2">
      <button type="button" class="btn btn-success btn-sm">
        Exportar Livros Disponíveis (CSV)
      </button>
    </a>
    <a href="{% url 'export_books_csv' %}?status=emprestado">
      <button type="button" class="btn btn-warning btn-sm">
        Exportar Livros Emprestados (CSV)
      </button>
    </a>
  </div>
</div>
{% endif %}

<!-- Exibição de mensagens -->
{% if messages %} {% for message in messages %}
<div class="alert alert-success" role="alert">{{ message }}</div>
{% endfor %} {% endif %}

<div class="row">
  {% if object_list %}
  <div class="col-12" style="overflow-x: scroll">
    <table class="table">
      <thead class="thead-dark">
        <tr>
          <th scope="col">Nome</th>
          <th scope="col">Descrição</th>
          <th scope="col">Preço</th>
          <th scope="col">Status</th>
          <th scope="col">Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for product in object_list %}
        <tr>
          <td>{{ product.name }}</td>
          <td>{{ product.description }}</td>
          <td>{{ product.price }}</td>
          <td>
            {% if product.status == 'disponivel' %}
              <span class="badge bg-success">Disponível</span>
            {% elif product.status == 'emprestado' %}
              <span class="badge bg-warning">Emprestado</span>
            {% elif product.status == 'em_manutencao' %}
              <span class="badge bg-info">Em Manutenção</span>
            {% else %}
              <span class="badge bg-danger">Indisponível</span>
            {% endif %}
          </td>
          <td>
            <div class="btn-group" role="group">
              <a href="{% url 'product_view' product.id %}" class="btn btn-outline-primary btn-sm">
                Visualizar
              </a>
              {% if not user.is_superuser and not user.is_staff and product.status == 'disponivel' %}
                <a href="{% url 'reserve_book' product.id %}" class="btn btn-outline-success btn-sm">
                  Reservar
                </a>
              {% endif %}
              {% if user.is_superuser or user.is_staff %}
                <a href="{% url 'product_delete' product.id %}" class="btn btn-outline-danger btn-sm">
                  Deletar
                </a>
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="col-12">
    <div class="alert alert-warning" role="alert">
      There is no product, yet. But if you want, you can add from
      <a class="badge badge-info" href="{% url 'product_new' %}">
        <strong>here.</strong>
      </a>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
